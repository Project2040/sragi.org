# ===========================================================
# SRAGI WEB BIOS v2.2.0r — CLEAN SRAGI ARCHITECTURE (SSOT)
# © 2025 Rune Solberg / Neptunia Media AS
# Licensed under CC BY 4.0 via SRAGI Regenerative License (SRL) v1.1
# 
# Purpose: The absolute Single Source of Truth for SRAGI.org system definition.
# Philosophy: "Clean SRAGI" — Native WP structures driven by Git SSOT.
#             No CPTs. No ACF reliance. Full Frontmatter control.
# ===========================================================

meta:
  id: SRAGI-WEB-BIOS
  version: "2.2.0r" # r = Revision needed (Alignment with _CONFIG structure)
  type: system-architecture
  revision_note: "Adjusted paths to match docs/ structure and Frontmatter nesting."
  maintainer: Rune Solberg
  organization: Neptunia Media AS
  updated: 2025-12-09
  philosophy: "Helhet → Struktur → Detaljer (Triadic wholeness)"

# ===========================================================
# LAG 1: ONTOLOGI — HVA ER TING?
# ===========================================================

layer_1_ontology:
  description: "Definisjon av innholdstyper mapet til Native WordPress."
  
  content_types:
    documentation:
      id: documentation
      wp_type: page
      nature: static
      purpose: "Evergreen knowledge (Principles, BIOS, Guides)"
    
    reflection:
      id: reflection
      wp_type: post
      nature: dynamic
      purpose: "Time-stamped insights and explorations"
    
    structure:
      id: structure
      wp_type: page
      nature: organizational
      purpose: "Navigation nodes defined in IA (e.g. Pillars/Clusters)"
    
    media:
      id: media
      wp_type: attachment
      nature: binary
      purpose: "Visual tokens and assets (Git-synced)"

# ===========================================================
# LAG 2: RELASJONER — HVORDAN HENGER TING SAMMEN?
# ===========================================================

layer_2_relations:
  description: "Struktur styrt av BIOS og Frontmatter metadata."
  
  structural_relations:
    hierarchy:
      type: nested
      structure: "Pillar (Parent Page) → Cluster (Child Page) → Leaf (Grandchild)"
      enforcement: "Sync Engine maps Frontmatter parent to wp_post_parent"
      
    metadata_keys:
      description: "Keys required to enforce relations in DB"
      keys:
        - _sragi_parent_id
        - _sragi_pillar
        - _sragi_cluster

# ===========================================================
# LAG 3: GOVERNANCE (SSOT) — HVEM STYRER HVA?
# ===========================================================

layer_3_governance:
  description: "Pekere til Sannheten. Ingen data lever kun i DB."
  
  ssot_files:
    
    ia_structure:
      file: /docs/architecture/WEB-BIOS.yaml
      controls: [system-definition, content-types]
      format: yaml
      
    ontology_data:
      file: /docs/_CONFIG/TAXONOMY_GRAPH.yaml
      controls: [pillars, domains, valid-terms]
      format: yaml

    validation_logic:
      file: /docs/_CONFIG/VALIDATION_RULES.yaml
      controls: [seo-limits, markdown-structure, media-specs]
      format: yaml

    content_schema:
      file: /docs/_CONFIG/CONTENT-TEMPLATE.yaml
      controls: [frontmatter-structure, required-fields]
      format: yaml
      
    visual_system:
      file: /docs/standards/VISUAL-PROTOCOL.md
      controls: [ratios, formats, naming]
      format: markdown
      
    license:
      file: /SRL-LICENSE.yaml
      controls: [license-metadata, permissions]
      format: yaml

# ===========================================================
# LAG 4: DATA-FLOWS — "GIT SYNC IS KING"
# ===========================================================

layer_4_data_flows:
  primary_flows:
    
    github_to_wordpress:
      id: github-wp-sync
      source: GitHub (Git repository)
      target: WordPress (Native DB tables)
      trigger: Git push to main
      
      frontmatter_parsing:
        description: "Sync Engine reads fields based on CONTENT-TEMPLATE.yaml schema."
        schema_source: /docs/_CONFIG/CONTENT-TEMPLATE.yaml
        critical_mapping:
          - meta.type      -> post_type / category
          - meta.title_en  -> post_title (if lang=en)
          - meta.slug      -> post_name
          - ia.pillar      -> taxonomy_term
          - ia.parent      -> post_parent logic
          
      multilingual_strategy:
        principle: "wpml_from_ssot: true"
        logic: "Engine reads language fields from YAML/MD and updates WPML tables directly."

# ===========================================================
# LAG 5: PRESENTASJON — HVORDAN SER DET UT?
# ===========================================================

layer_5_presentation:
  description: "Frontend delivery via Bricks Builder & Headless APIs."
  
  engine:
    core: WordPress + Bricks Builder
    styling: CSS Variables synced from /docs/standards/SRAGI-CSS.md
  
  assets:
    delivery: Bunny.net CDN (Edge)
    source: /content/visuals/ (Git) -> Optimized AVIF/WebP

# ===========================================================
# LAG 6: METADATA — SYSTEMETS HUKOMMELSE
# ===========================================================

layer_6_metadata:
  core_metadata:
    fields:
      - field: _sragi_source_file
        purpose: "Path in GitHub repo"
      - field: _sragi_content_hash
        purpose: "Change detection"
      - field: _sragi_synced_at
        purpose: "Sync timestamp"
      - field: _sragi_version
        purpose: "Content version tracking"

# ===========================================================
# LAG 7: API OPERATIONS
# ===========================================================

layer_7_api:
  description: "REST Endpoints aligned with OpenAPI v1.1"
  base: /wp-json/sragi/v1
  endpoints:
    - path: /ssot
      method: GET
      logic: "Serve parsed BIOS YAML"
      
    - path: /ssot/validate
      method: POST
      logic: "Validate content integrity vs Validation Rules"
      
    - path: /sync/webhook
      method: POST
      logic: "Trigger Sync Engine for changed files"
      
    - path: /sync/webhook
      method: POST
      logic: "Trigger Sync Engine for changed files (HMAC verified)"
      
    - path: /sync/pages
      method: POST
      logic: "Force sync of specific pages/structures"
